---
title: "Presentasjon av ModSEM"
output:
  html_document:
    df_print: paged
---

# Residual Centering Approach (simplified) 

## Step 1:
Create products of the indicators belonging to the latent interactionterm, and compute their residuals.

## Step 2:
Use these residuals as the indicators of your analysis 

## Step 3 (optional): specify the residual covariances
Note:
The centering term is a bit misleading, as it implies centering your variables before or after calculating the products/residuals. But it likeley refers to the fact that residuals are supposed to be centered around zero anyways 

# unconstrained approach

## Step 1:
Center the indicators belong to the latent interaction terms, and create products based on them.

## Step 2: 
Use these as indicators for your latent interaction term 

## Step 3: 
Specify constraints: 1. Specify residual covariances, 2. Specify that the mean of XZ = cov(X, Z)

# Example 1: Showing some random syntaxes

There is an exponential increase in indicators, and specified covariances with increases in indicators for the latent variables included in the interaction term

```{r}
library(lavaan)
library(modsem)

setwd("C:/Users/slupp/OneDrive/Skrivebord/MasterOppgaveMehmet/data")
df1 <- readRDS("exampleData1.rds")
df2 <- readRDS("exampleData4.rds")
df3 <- readRDS("exampleData3.rds")
```

## Syntax1

```{r}
s1 <- '
  # outer Model
  Attitude =~ ATTD1 + ATTD2 + ATTD4 + ATTD4
  PBC =~ PBC1 + PBC2 + PBC3 + PBC4
  Behaviour =~ PB1 + PB2 + PB3 + PB4
  SN =~ SN1 + SN2 + SN3 + SN4
  pestY =~ ty1 + ty2
  TestX =~ tx1 + tx2

  # Higher order
  Intention =~ PBC + SN + Attitude

  # Inner model
  Behaviour ~ Intention + PBC + Intention:PBC + pestY :TestX
  Behaviour ~ Intention + PBC + pestY :TestX
'
readS1 <- readModsem(s1) 
cat(readS1$modifiedSyntax)

```

```{r}
s2 <- '
  # Outer Model
  Attitude =~ ATTD1 + ATTD2 + ATTD4 + ATTD4
  PBC =~ PBC1 + PBC2 + PBC3 + PBC4
  Behaviour =~ PB1 + PB2 + PB3 + PB4
  SN =~ SN1 + SN2 + SN3 + SN4
  TestY =~ ty1 + ty2
  TestX =~ tx1 + tx2

  # Higher order
  Intention =~ PBC + SN + Attitude

  # Inner model
  Behaviour ~ Intention + PBC + TestY :TestX + Intention:PBC
'

readS2 <- readModsem(s2) 
cat(readS2$modifiedSyntax)
```

```{r}
s3 <- '
  # Outer Model
  Attitude =~ ATTD1 + ATTD2 + ATTD4 + ATTD4
  PBC =~ PBC1 + PBC2 + PBC3 + PBC4
  Behaviour =~ PB1 + PB2 + PB3 + PB4
  SN =~ SN1 + SN2 + SN3 + SN4
  TestY =~ ty1 + ty2
  TestX =~ tx1 + tx2
  Hello =~ H1 + H2
  # Higher order
  Intention =~ PBC + SN + Attitude

  # Inner model
  Behaviour ~ Intention + PBC + TestY :TestX + Intention:PBC:Hello

'
readS3 <- readModsem(s3) 
cat(readS3$modifiedSyntax)
```


# Example 1: One interaction 

```{r}
m1 <- '
  # Outer Model
  X =~ x1 + x2 +x3
  Y =~ y1 + y2 + y3
  Z =~ z1 + z2 + z3

  # Inner model
  Y ~ X + Z + X:Z
'


realModel <- lm(realY ~ realX + realZ + realX:realZ, df1)
summary(realModel)
psummary(realModel, std_beta = TRUE)
```

## Residual Centering Approach
```{r}
latentModelRca <- modsem(m1, df1, method = "rca")
lavaan::summary(latentModelRca$lavaan)
```

## unconstrained Approach

```{r}
latentModelUncent <- modsem(m1, df1, method = "unconstrained")
lavaan::summary(latentModelUncent$lavaan)
```

# Example 2: Two interactions

## Model


```{r}
m2 <- '
  # Outer Model
  X =~ x1 + x2 +x3
  Y =~ y1 + y2 + y3
  Z =~ z1 + z2 + z3
  G =~ g1 + g2 + g3
  H =~ h1 + h2 + h3

  # Inner model
  Y ~ X + Z + G + H + X:Z + G:H
'


realModel2 <- lm(realY ~ realX*realZ + realG*realH, df2)
summary(realModel2)
```

## Residual Centering Approach
```{r}
m2 <- '
  # Outer Model
  X =~ x1 + x2 +x3
  Y =~ y1 + y2 + y3
  Z =~ z1 + z2 + z3
  G =~ g1 + g2 + g3
  H =~ h1 + h2 + h3

  # Inner model
  Y ~ X + Z + G + H + X:Z + G:H
'
latentModelRca2 <- modsem(m2, df2, method = "rca")
lavaan::summary(latentModelRca2$lavaan)
```

## unconstrained Approach

```{r}
latentModelUncent2 <- modsem(m2, df2, method = "unconstrained")
lavaan::summary(latentModelUncent2$lavaan)
```

# Example 3: Only main effect

```{r}
m3 <- '
  # Outer Model
  X =~ x1 + x2 +x3
  Y =~ y1 + y2 + y3
  Z =~ z1 + z2 + z3

  # Inner model
  Y ~ X + Z + X:Z
'


realModel <- lm(realY ~ realX*realZ, df3)
summary(realModel)
```

## Residual Centering Approach
- Note: The results here are closer to the actual relationship when modelling the data. as i added some random variance to the realY, to make the relationship between the variables weaker
```{r}
latentModelRca3 <- modsem(m3, df3, method = "rca")
lavaan::summary(latentModelRca3$lavaan)
```

## unconstrained Approach

```{r}
latentModelUncent <- modsem(m3, df3, method = "unconstrained")
lavaan::summary(latentModelUncent$lavaan)
```
